<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE topic
  PUBLIC "-//OASIS//DTD DITA Topic//EN" "topic.dtd">
<topic xml:lang="ja" id="topic1284">
  <title>リバランス操作</title>
  <shortdesc>リバランス操作はクラスタサイズを拡張または縮小、フェイルオーバへの対処、様々なアップグレードのために一時的にノードを削除するために実行します。</shortdesc>
  
  <body>
   <p>リバランス操作中は:
    <ul>
      <li><p>新しいCouchbase Serverクラスタ構成を利用し、各ノード上のvBucketのデータを古い構成から移動します。 この処理はクラスタ内の各ノード上のvBucket内にあるデータを交換します。 このため、二つの影響を与えます:</p>
        <ul>
          <li><p>クラスタから削除されたマシンのデータを削除する。 これらのマシン上のデータストレージを完全に削除することで、削除されたノードを、クラスタ操作に影響を与えることなく、クラスタから削除できるようになります。</p></li>
          <li><p>クライアントからの情報をサービスできるように、データを追加し、新規ノードを有効にします。 アクティブデータを新規ノードに移動することで、これらのノードは移動されたvBucketを担当することになり、クライアントリクエストを処理します。</p></li>
        </ul></li>
      <li><p>リバランスはRAM内に保存されたデータ、ディスク内に保存されたデータの両方を移動します。 これをクラスタ内のすべてのノード、すべてのバケットで実行します。 移動にかかる時間はクラスタ活動の度合い、保存された情報量に依存します。</p></li>
      <li><p>リバランス中でもクラスタは稼働し、継続してクライアントリクエストを処理します。
            データ移行処理の最中に保存されたデータが更新または変更されても、それらはリバランスがリクエストされた時点で存在したデータとともに更新され、移行されます。</p></li>
      <li><p>クラスタ内のどのノードがクライアントリクエストの処理を担当するかを特定する現在のvBucketマップは、各vBucketが移動するとインクリメンタルに更新されます。 更新されたvBucketマップはCouchbaseクライアントライブラリやスマートクライアントとして稼働するサービス(Moxiなど)に転送され、リバランスが進むにつれて、クライアントが更新された構成を利用できるようにします。 このため、新しい構成が即座に利用されることを保証し、リバランス操作中の負荷を均等に拡散することを可能としています。</p></li>
    </ul></p>
    <p>クラスタはリバランス処理中でもアクティブに稼働しているので、クライアントは情報の保存や取得を継続することができ、リバランス操作が実行されていることを気にする必要はありません。</p>
    <p>リバランス操作を実行する4つの主な理由があります:</p>
    <ul>
      <li><p>クラスタのサイズを拡張するためにノードを追加する。</p></li>
      <li><p>クラスタのサイズを縮小するためにノードを削除する。</p></li>
      <li><p>フェイルオーバ発生後の対応として、クラスタを健全な状態に復元する。</p></li>
      <li><p>一時的に一つ以上のノードを削除し、ソフトウェア、オペレーティングシステム、またはハードウェアのアップグレードを行う。</p></li>
    </ul>
    <p>直接的な理由に関わらず、リバランスの目的は、設定されたノード、バケット、レプリカへと現在のクラスタの状態を一致させ、クラスタを健全な状態に遷移させることです。</p>
    
    
    
  </body>
</topic>
