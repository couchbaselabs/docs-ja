<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Disk write queue</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../assets/stylesheets/application.css"><link rel="stylesheet" href="../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation"><header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><a href="http://www.couchbase.com/learn" class="developer-porta-header__navigation__back">
							Return to Learn
						</a><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/developer">Developer Documentation</a></li><li class="developer-portal-header__navigation__item"><a href="http://developer.couchbase.com/mobile">Couchbase Mobile</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li><li class="developer-portal-header__navigation__item"><a href="http://docs.couchbase.com/archive-index">Documentation Archives</a></li></ul><div class="developer-portal-header__search"></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><div class="developer-portal-sidebar__versions"><ul id="developer-portal-versions-navigation"><li class="active"><a href="#"><span>Version 3.0</span></a></li><li class=""><a href="http://docs.couchbase.com/archive-index"><span>Older</span></a></li></ul></div><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../Couchbase-intro.html"><span>はじめに</span></a></li><li class="section"><a href="../Whats-new-3.0.html"><span>3.0の新機能</span></a></li><li class="section section--has-sub-sections"><a href="../install-intro.html"><span>インストールとアップグレード</span></a></li><li class="section section--has-sub-sections section--active"><a href="../admin-intro.html"><span>Couchbase Serverの管理</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../Misc/admin-basics.html"><span>Couchbase Server管理の基本</span></a></li><li class="section section--has-sub-sections"><a href="../Concepts/concept-intro.html"><span>アーキテクチャと概念</span></a></li><li class="section section--has-sub-sections"><a href="../security/security-intro.html"><span>セキュリティ</span></a></li><li class="section section--has-sub-sections"><a href="../Concepts/bp-deployment-considerations.html"><span>デプロイ構成の考慮事項</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/cluster-management.html"><span>クラスタ管理</span></a></li><li class="section section--has-sub-sections section--active"><a href="../Monitoring/monitor-intro.html"><span>モニタリング</span></a><ul class="sub-sections"><li class="section"><a href="../Monitoring/monitor-underlying-processes.html"><span>Underlying server processes</span></a></li><li class="section"><a href="../Monitoring/monitor-port-access.html"><span>Port numbers and accessing different buckets</span></a></li><li class="section"><a href="../Monitoring/monitor-diskqueue.html" class="current"><span>Disk write queue</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../Monitoring/monitor-statistics.html"><span>Couchbase Server statistics</span></a></li><li class="section"><a href="../Monitoring/monitor-moxi-statistics.html"><span>Couchbase Server Moxi statistics</span></a></li><li class="section"><a href="../Monitoring/monitor-warmup.html"><span>Monitoring startup (warmup)</span></a></li><li class="section"><a href="../Monitoring/monitor-rebalance.html"><span>Monitoring a rebalance operation</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../XDCR/xdcr-intro.html"><span>クロスデータセンターレプリケーション（XDCR）</span></a></li><li class="section section--has-sub-sections"><a href="../UI/ui-intro.html"><span>Webコンソール</span></a></li><li class="section"><a href="../Misc/faq.html"><span>FAQ</span></a></li><li class="section section--has-sub-sections"><a href="../Misc/Trbl-intro.html"><span>トラブルシューティング</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../Views/views-intro.html"><span>Viewとインデックス</span></a></li><li class="section section--has-sub-sections"><a href="../cli-intro.html"><span>CLIリファレンス</span></a></li><li class="section section--has-sub-sections"><a href="../rest-intro.html"><span>REST APIリファレンス</span></a></li><li class="section section--has-sub-sections"><a href="../rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
  <h1 class="title topictitle1">Disk write queue</h1>

  
  <div class="body"><p class="shortdesc">Disk writing is implemented as a 2-queue system: commit to DRAM and then queued to be written to disk</p>

    <p class="p">Couchbase Server is a persistent database which means that part of monitoring the system is
      understanding how we interact with the disk subsystem.</p>

    <p class="p">Since Couchbase Server is an asynchronous system, any mutation operation is committed first
      to DRAM and then queued to be written to disk. The client is returned an acknowledgment almost
      immediately so that it can continue working. There is replication involved here too, but we’re
      ignoring it for the purposes of this discussion.</p>

    <p class="p">Disk writing is implemented as a 2-queue system and are tracked by the stats. The
      first queue is where mutations are immediately placed. Whenever there are items in that queue,
      our “flusher” (disk writer) comes along and takes all the items off of that queue, places them
      into the other one and begins writing to disk. Since disk performance is so dramatically
      different from RAM, new writes can be continuously accepted while the system is (possibly
      slowly) writing new ones to the disk.</p>

    <p class="p">The flusher will process 250k items at a time, then perform a disk commit and continue this
      cycle until its queue is drained. When it has completed everything in its queue, it will
      either grab the next group from the first queue or essentially sleep until there are more
      items to write.</p>

    
    <div class="section"><h2 class="title sectiontitle">Monitoring the disk write queue</h2>
      <p class="p">There are basically two ways to
        monitor the disk queue, at a high-level from the Web UI or at a low-level from the
        individual node statistics.</p>

      <ol class="ol">
        <li class="li">From the Web UI, click on Monitor Data Buckets and select the particular bucket that you
          want to monitor.</li>

        <li class="li">Click “Configure View” in the top right corner and select the “Disk Write Queue”
          statistic. Closing this window shows that there is a new mini-graph.</li>

      </ol>

      <p class="p">This graph is showing the Disk Write Queue for all nodes in the cluster. 
        To get a deeper view into this statistic, monitor each node individually using the ‘stats’ output. 
        The statistics to watch are <samp class="ph codeph">ep_queue_size</samp> (where new mutations are placed) and <samp class="ph codeph">flusher_todo</samp>
        (the queue of items currently being written to disk).</p>
</div>

  </div>

  
  <nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../Monitoring/monitor-intro.html" title="プロセス、ポート、キューなど、Couchbase Serverをモニタリングするためのさまざまな方法があります。">モニタリング</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../Monitoring/monitor-port-access.html">Port numbers and accessing different buckets</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../Monitoring/monitor-statistics.html" title="Couchbase Server provides statistics at multiple levels throughout the cluster.">Couchbase Server statistics</a></div>
</div>

<div class="linklist linklist">
<div><a class="link" href="../UI/ui-server-nodes.html" title="The Server Nodes section shows statistics across the server nodes in the cluster.">Server Nodes</a></div>
<div><a class="link" href="monitor-statistics.html" title="Couchbase Server provides statistics at multiple levels throughout the cluster.">Couchbase Server statistics</a></div></div>
</nav>
</div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b> All rights reserved.</span><a href="http://www.couchbase.com/developers">Developer Portal</a><a href="http://forums.couchbase.com">Forums</a><a href="http://www.couchbase.com/downloads">Download</a><a href="http://support.couchbase.com/">Customer Support Login</a></p></footer></div></main><script src="../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../';</script><script src="../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>