<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Viewと保存データ</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../assets/stylesheets/application.css"><link rel="stylesheet" href="../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation"><header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><a href="http://www.couchbase.com/learn" class="developer-porta-header__navigation__back">
							Return to Learn
						</a><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/developer">Developer Documentation</a></li><li class="developer-portal-header__navigation__item"><a href="http://developer.couchbase.com/mobile">Couchbase Mobile</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li><li class="developer-portal-header__navigation__item"><a href="http://docs.couchbase.com/archive-index">Documentation Archives</a></li></ul><div class="developer-portal-header__search"></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><div class="developer-portal-sidebar__versions"><ul id="developer-portal-versions-navigation"><li class="active"><a href="#"><span>Version 3.0</span></a></li><li class=""><a href="http://docs.couchbase.com/archive-index"><span>Older</span></a></li></ul></div><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../Couchbase-intro.html"><span>はじめに</span></a></li><li class="section"><a href="../Whats-new-3.0.html"><span>3.0の新機能</span></a></li><li class="section section--has-sub-sections"><a href="../install-intro.html"><span>インストールとアップグレード</span></a></li><li class="section section--has-sub-sections"><a href="../admin-intro.html"><span>Couchbase Serverの管理</span></a></li><li class="section section--has-sub-sections section--active"><a href="../Views/views-intro.html"><span>Viewとインデックス</span></a><ul class="sub-sections"><li class="section"><a href="../Views/views-basics.html"><span>Viewの基本</span></a></li><li class="section"><a href="../Views/views-index-updates.html"><span>ストリームベースのView</span></a></li><li class="section"><a href="../Views/views-operation.html"><span>Viewの動作</span></a></li><li class="section"><a href="../Views/views-storedData.html" class="current"><span>Viewと保存データ</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../Views/views-development.html"><span>開発View</span></a></li><li class="section"><a href="../Views/views-production.html"><span>プロダクションView</span></a></li><li class="section"><a href="../Views/views-writing.html"><span>Writing views</span></a></li><li class="section"><a href="../Views/views-geospatial.html"><span>Writing geospatial views</span></a></li><li class="section"><a href="../Views/views-schemaless.html"><span>Views in a schema-less database</span></a></li><li class="section"><a href="../Views/views-translateSQL.html"><span>Translating SQL to map/reduce</span></a></li><li class="section"><a href="../Views/views-querying.html"><span>Querying views</span></a></li><li class="section"><a href="../Views/views-querySample.html"><span>View and query examples</span></a></li><li class="section section--has-sub-sections"><a href="../Misc/sample-bucket-intro.html"><span>Sample buckets</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../cli-intro.html"><span>CLIリファレンス</span></a></li><li class="section section--has-sub-sections"><a href="../rest-intro.html"><span>REST APIリファレンス</span></a></li><li class="section section--has-sub-sections"><a href="../rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
  <h1 class="title topictitle1">Viewと保存データ</h1>

  
  <div class="body"><p class="shortdesc">このセクションはViewシステムが保存データと関連してどのように動作するのかを解説します。</p>

		<p class="p">
			Viewシステムはクラスタ内にJSONドキュメント形式で保存されている情報に依存しています。
			この形式でデータをフォーマットすることで、データ内の各フィールドを特定でき、インデックスのコンポーネントで利用できます。
		</p>

		<p class="p">
			Couchbaseデータベースに情報が保存されると、保存されたデータはパースされ、有効なJSONだと特定されると、有効なJSONとしてデータベース内で特定され、タグ付けられます。
			情報が有効なJSONとしてパースできない場合、送信されたデータのコピーを文字通りバイナリとして保存します。
		</p>

    
    <div class="fig fignone"><img class="image" src="../images/view-types-datastore.png" width="600"></div>

    
    <p class="p">保存したデータを取得する際、情報のフォーマットはデータが有効なJSONとしてタグ付けされているかどうかに依存します:</p>

    
    <div class="section"><h2 class="title sectiontitle">JSON情報</h2>
    
			<p class="p">
				JSONとして判定された情報は保存された状態と同一の形式で返却されます。
				この情報は意味的に同一で、送信された状態と同じフィールド、データ、構造で返却されます。
				Viewの処理中には、ドキュメントのメタデータ情報が別の構造として提供され、利用できます。
			</p>

    <p class="p">空白文字、フィールドの順序は送信されたバージョンのJSONドキュメントと異なる場合があります。</p>

		<p class="p">例えば、以下のJSONドキュメントを<samp class="ph codeph">mykey</samp>のキーで保存します:</p>


    <pre class="pre codeblock"><code>
{
   "title" : "Fish Stew",
   "servings" : 4,
   "subtitle" : "Delicious with fresh bread"
}
</code></pre>


    <p class="p">Viewプロセッサ内では以下の様に返される場合があります:</p>

    <pre class="pre codeblock"><code>
{
    "servings": 4,
    "subtitle": "Delicious with fresh bread",
    "title": "Fish Stew"
}
    </code></pre>

    </div>

    
    <div class="section"><h2 class="title sectiontitle">JSON以外の情報</h2>
    
			<p class="p">
				JSONとしてパースできない情報は常にデータベースに送信された情報のバイナリコピーとして保存され、返却されます。
				例えば、画像を保存すると、保存された画像と同一のバイナリコピーが返されます。
			</p>

			<p class="p">
				JSON以外のデータはbase64文字列としてView処理中に利用できます。
				JSON以外のドキュメントはメタデータ構造の<samp class="ph codeph">type</samp>フィールドを参照し特定できます。
			</p>

    <p class="p">返却された構造は、WebコンソールでのView編集時に確認できます。</p>

    </div>

    
    
    <div class="section"><h2 class="title sectiontitle">JSONの基本</h2>
			<p class="p">
				JSONは軽量で、容易にパースでき、クロスプラットフォームなデータ表現形式です。
				ブラウザを含む全てのプラットフォームと全ての言語、アプリケーションフレームワークで、JSON形式のデータを扱い、開発者の仕事を効率的に助けるために設計された多くのライブラリやツールが存在します。
			</p>

      <p class="p">JSONはJavaScriptでサポートされる基本的な型をサポートしています:</p>

      <ul class="ul">
        <li class="li">Number (整数もしくは浮動小数)</li>

      </ul>
<p class="p">JavaScriptがサポートする最大の数値は2<sup class="ph sup">53</sup>です。クライアントライブラリの環境でこれより大きな数字（例えば、64-bitの数字）を扱う場合は、文字列として値を保存する必要があります。</p>
<ul class="ul">
        <li class="li"><p class="p">String — 二重引用符で囲まれた文字とUnicode文字やバックスラッシュエスケープをサポートします。例:</p>

          <pre class="pre codeblock"><code>"A String"</code></pre>
</li>

				<li class="li"><p class="p">Boolean — <samp class="ph codeph">true</samp>もしくは<samp class="ph codeph">false</samp>の値です。
				これらの文字列を直接利用できます。例:</p>
<samp class="ph codeph">{ "value": true}</samp></li>

        <li class="li"><p class="p">Array — 角かっこで囲まれた値のリストです。例:</p>

          <samp class="ph codeph">["one", "two", "three"]</samp></li>

				<li class="li"><p class="p">Object — キー/値ペアのセット(すなわち、連想配列、またはハッシュ)です。
					キーは文字列でなければなりませんが、値はJSONでサポートされている全ての値を利用できます。例:</p>

          <pre class="pre codeblock"><code>{
   "servings" : 4,
   "subtitle" : "Easy to make in advance, and then cook when ready",
   "cooktime" : 60,
   "title" : "Chicken Coriander"
}
</code></pre>
</li>

      </ul>

      <p class="p">キーは文字列でなければなりませんが、値はJSONでサポートされている全ての値を利用できます。</p>
</div>

    
    
    <div class="section"><h2 class="title sectiontitle">ドキュメントメタデータ</h2>
			<p class="p">ビューの処理中に、各ドキュメントのメタデータは、独立したJSONオブジェクト<samp class="ph codeph">meta</samp>として参照でき、オプションで<samp class="ph codeph">map()</samp>関数の第二引数として定義されています。このメタデータは処理中のドキュメントを識別、特定するために利用することができます。</p>

			<p class="p"><samp class="ph codeph">meta</samp>構造には、次のフィールド、及び関連情報が含まれています:</p>

      <ul class="ul">
        <li class="li"><samp class="ph codeph">id</samp></li>

      </ul>
<p class="p">保存データオブジェクトのID、あるいはキーです。Couchbaseデータベースにオブジェクトを書き込んだ際に指定したキーと同じです。</p>
<ul class="ul">
        <li class="li"><samp class="ph codeph">rev</samp></li>

      </ul>
<p class="p">情報の現在のリビジョンを記録するために、内部で利用されるリビジョンIDです。このフィールドに格納された情報は一貫性がなく、追跡もできないので、クライアントアプリケーションからは利用すべきではありません。</p>
<ul class="ul">
        <li class="li"><samp class="ph codeph">type</samp></li>

				</ul>
<p class="p">格納されたデータのタイプを指定します。有効なJSONドキュメントには<samp class="ph codeph">json</samp>タイプが設定されます。
				バイナリデータとして識別されたドキュメントは<samp class="ph codeph">base64</samp>タイプが設定されます。</p>
<ul class="ul">
        <li class="li"><samp class="ph codeph">flags</samp></li>

				</ul>
<p class="p">データが保存されたときに設定されたフラグの数値です。
				フラグの値の利用可否と値はデータを保存する際に利用しているクライアントライブラリに依存します。
				内部的にフラグは32ビット整数として格納されます。</p>
<ul class="ul">
        <li class="li"><samp class="ph codeph">expiration</samp></li>

      </ul>

			<p class="p">格納されたオブジェクトの有効期限の値です。
				有効期限は常に絶対的なUnixエポック時間として保存されています。</p>

			<p class="p">これらの付加的なフィールドはViewサーバでドキュメントを処理している間だけ参照できます。
				これらのフィールドはMemcached/Couchbaseプロトコルを介してオブジェクトにアクセスしても、ドキュメントの一部としては返却されません。</p>

    </div>

    
    
		<div class="section"><h2 class="title sectiontitle">JSON以外のデータ</h2>
			<p class="p">
				Couchbaseに保存された全てのドキュメントはJSON構造を返しますが、サブミットされた情報でJSONドキュメントとしてパースできたものだけがJSONドキュメントとして保存されます。
				JSONドキュメントにパースできない値を保存した場合、オリジナルのバイナリデータが保存されます。
				これは、<samp class="ph codeph">map()</samp>関数に与えられる<samp class="ph codeph">meta</samp>オブジェクトを使用して、ビューの処理中に識別することができます。
				JSONドキュメントではなく、バイナリドキュメントとして識別され、保存されているドキュメントであっても、ビューシステムにより、キーのデータを利用してインデックスを作成することができます。
				ドキュメントのキーが意味を持つ場合に特に有効です。
				たとえば、レコードのタイプを識別するために、キーにプレフィックスを付けている場合、ドキュメントのタイプでインデックスを作成できます。
		</p>
</div>

    
    
		<div class="section"><h2 class="title sectiontitle">ドキュメントストレージとインデックスの処理順序</h2><p class="p">
				Couchbase Serverへ情報が格納される手順は、どのように、どのタイミングで情報のインデックスが作成されるのかに影響をあたえ、インデックスとデータがクラスタに保存されるタイミングは関連しています。
				加えて、データのインデクシングはViewシステムとそのViewへアクセスする際の設定が影響します。
			</p>

      
      
      
      
      <p class="p">基本的なデータ保存とインデクシングの順序は以下のようになります:</p>

      
      
      
      <ol class="ol">
        <li class="li">ドキュメントがクラスタに保存されます。まず、RAM上にのみドキュメントが保存されます。</li>

        <li class="li">ドキュメントはレプリケーションを通してインデクサへと渡され、Viewによりインデクシングされます。</li>

      </ol>

      
			<p class="p">
				この処理順序は、インデクサへと変更がレプリケートされるレイテンシをベースとして、メモリに保存されている情報とViewの実行結果の間には結果整合性があることを意味します。
				クラスタに新規にドキュメントを保存したあと、インデックスにアクセスすると、新規に保存されたドキュメントが生成されたView内に出現しない可能性があります。
			</p>

        
      
			<p class="p">
				また、期限切れチェック処理によってデータベースから削除されるまで、有効期限付きのドキュメントがビューインデックス内に存在し続ける場合もあります。
			</p>

      
			<p class="p">
				Couchbase ServerはObserveコマンドをサポートしており、対象のドキュメントがインデクサにレプリケートされたか、インデックスに含まれているかどうかといった、ドキュメントの現在の状態を確認することができます。
			</p>

			<p class="p">Viewにアクセスする際、Viewの内容は保存されているドキュメントとは非同期です。
				加えて、ビューの作成や変更は<span class="keyword option">stale</span>パラメータに依存します。 
				これはViewのコンテンツをクエリする際に、Viewをいつ、どのように更新するのかを制御します。
      </p>

    </div>

    
  </div>

  <nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>親トピック:</strong> <a class="link" href="../Views/views-intro.html" title="CouchbaseのViewはデータをインデクシングしクエリを可能とします。">Viewとインデックス</a></div>
<div class="previouslink"><strong>前のトピック:</strong> <a class="link" href="../Views/views-operation.html" title="このセクションではView動作や様々なViewやデータに関連する機能を説明します。">Viewの動作</a></div>
<div class="nextlink"><strong>次のトピック:</strong> <a class="link" href="../Views/views-development.html" title="Viewはデプロイ前のViewの影響を制御するために、開発環境で作成されます。">開発View</a></div>
</div>

<div class="linklist linklist">
<div><a class="link" href="views-operation.html" title="このセクションではView動作や様々なViewやデータに関連する機能を説明します。">Viewの動作</a></div></div>
</nav>
  
</div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b> All rights reserved.</span><a href="http://www.couchbase.com/developers">Developer Portal</a><a href="http://forums.couchbase.com">Forums</a><a href="http://www.couchbase.com/downloads">Download</a><a href="http://support.couchbase.com/">Customer Support Login</a></p></footer></div></main><script src="../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../';</script><script src="../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>