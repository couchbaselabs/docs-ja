<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Rebalance behind-the-scenes</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../assets/stylesheets/application.css"><link rel="stylesheet" href="../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation"><header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><a href="http://www.couchbase.com/learn" class="developer-porta-header__navigation__back">
							Return to Learn
						</a><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/developer">Developer Documentation</a></li><li class="developer-portal-header__navigation__item"><a href="http://developer.couchbase.com/mobile">Couchbase Mobile</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li><li class="developer-portal-header__navigation__item"><a href="http://docs.couchbase.com/archive-index">Documentation Archives</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><div class="developer-portal-sidebar__versions"><ul id="developer-portal-versions-navigation"><li class="active"><a href="#"><span>Version 3.0</span></a></li><li class=""><a href="http://docs.couchbase.com/archive-index"><span>Older</span></a></li></ul></div><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../Couchbase-intro.html"><span>はじめに</span></a></li><li class="section"><a href="../Whats-new-3.0.html"><span>3.0の新機能</span></a></li><li class="section section--has-sub-sections"><a href="../install-intro.html"><span>インストールとアップグレード</span></a></li><li class="section section--has-sub-sections section--active"><a href="../admin-intro.html"><span>Couchbase Serverの管理</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../Misc/admin-basics.html"><span>管理の基礎</span></a></li><li class="section section--has-sub-sections"><a href="../Concepts/concept-intro.html"><span>アーキテクチャと概念</span></a></li><li class="section section--has-sub-sections"><a href="../security/security-intro.html"><span>セキュリティ</span></a></li><li class="section section--has-sub-sections"><a href="../Concepts/bp-deployment-considerations.html"><span>デプロイ構成の考慮事項</span></a></li><li class="section section--has-sub-sections section--active"><a href="../Tasks/cluster-management.html"><span>クラスタ管理</span></a><ul class="sub-sections"><li class="section"><a href="../Tasks/tasks-manage-serverWarmup.html"><span>Handling server warmup</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/tasks-manage-replication.html"><span>Handling replication</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/tasks-compaction.html"><span>Compacting data files</span></a></li><li class="section section--has-sub-sections section--active"><a href="../Tasks/cluster-maintenance.html"><span>Cluster maintenance</span></a><ul class="sub-sections"><li class="section"><a href="../Tasks/rebalance-adding-nodes.html"><span>Adding nodes</span></a></li><li class="section"><a href="../Tasks/rebalance-remove-node.html"><span>Removing nodes</span></a></li><li class="section section--has-sub-sections section--active"><a href="../Tasks/tasks-rebalance.html"><span>Rebalancing</span></a><ul class="sub-sections"><li class="section"><a href="../Concepts/concept-rebalancing.html"><span>Rebalancing operation</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/rebalance-performing.html"><span>Performing a rebalance</span></a></li><li class="section"><a href="../Tasks/rebalance-behind-the-scenes.html" class="current"><span>Rebalance behind-the-scenes</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../Tasks/rebalance-bucket-types.html"><span>Rebalance effect on bucket types</span></a></li><li class="section"><a href="../Tasks/rebalance-swap-rebalance.html"><span>Swap rebalance</span></a></li><li class="section"><a href="../Tasks/rebalance-factors.html"><span>Rebalancing factors</span></a></li><li class="section"><a href="../Tasks/rebalance-questions.html"><span>Common rebalancing questions</span></a></li></ul></li></ul></li><li class="section section--has-sub-sections"><a href="../Tasks/maintenance-server-node.html"><span>Server maintenance</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/tasks-backup-restore.html"><span>Backup and restore</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/tasks-manage-xdcr.html"><span>Managing XDCR</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../Monitoring/monitor-intro.html"><span>モニタリング</span></a></li><li class="section section--has-sub-sections"><a href="../XDCR/xdcr-intro.html"><span>クロスデータセンターレプリケーション（XDCR）</span></a></li><li class="section section--has-sub-sections"><a href="../UI/ui-intro.html"><span>Webコンソール</span></a></li><li class="section"><a href="../Misc/faq.html"><span>FAQ</span></a></li><li class="section section--has-sub-sections"><a href="../Misc/Trbl-intro.html"><span>トラブルシューティング</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../cli-intro.html"><span>CLI reference</span></a></li><li class="section section--has-sub-sections"><a href="../rest-intro.html"><span>REST API reference</span></a></li><li class="section section--has-sub-sections"><a href="../rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
 <h1 class="title topictitle1">Rebalance behind-the-scenes</h1>

 
 <div class="body conbody"><p class="shortdesc">The rebalance process is managed through a
  specific process called the <dfn class="term">orchestrator</dfn>.</p>

  
  <p class="p">The orchestrator examines the current vBucket map
   and then combines that information with the node additions and removals in order to create a new
   vBucket map.</p>

  <p class="p">The orchestrator starts the process of moving the individual vBuckets from
    the current vBucket map to the new vBucket structure. It only starts the process while thew nodes 
    themselves are responsible for actually performing the movement of data
    between the nodes. The aim is to make the newly calculated vBucket map match the current
    situation.</p>

  <p class="p">Each vBucket is moved independently, and a number of vBuckets can be migrated
     simultaneously in parallel between the different nodes in the cluster. On each destination node,
     a process called <samp class="ph codeph">ebucketmigrator</samp> is started. It uses the TAP system to
     request that all the data be transferred for a single vBucket, and that the new vBucket data
     becomes the active vBucket once the migration has been completed.</p>

  <p class="p">While the vBucket
      migration process is taking place, clients are still sending data to the existing vBucket. This
      information is migrated along with the original data that existed before the migration was
      requested. Once the migration of all the data has completed, the original vBucket is marked
      as disabled, and the new vBucket is enabled. This updates the vBucket map and is communicated
      back to the connected clients that will now use the new location.</p>

  
  
  
  <div class="section"><h2 class="title sectiontitle">Changing vBucket moves with REST</h2>
   <p class="p">The number of vBucket moves that occur during the rebalance
    operation can be modified. The default is one (1) and indicates that only one vBucket is moved at a time
    during the rebalance operation.</p>

  <p class="p">To change the number of vBucket moves, execute a curl <span class="keyword cmdname">POST</span>
         command using the following syntax with the <samp class="ph codeph">/internalSettings</samp> endpoint and
         the option <samp class="ph codeph">rebalanceMovesPerNode</samp>.</p>


  <pre class="pre codeblock"><code>
curl -X POST -u admin:password
 -d rebalanceMovesPerNode=1
 http://HOST:PORT/internalSettings
</code></pre>

  
  <p class="p">For example:</p>

   <pre class="pre codeblock"><code>
curl -X POST -u Administrator:password
 -d rebalanceMovesPerNode=14
 http://soursop-s11201.sc.couchbase.com:8091/internalSettings
</code></pre>

  </div>

  
  
 </div>

<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../Tasks/tasks-rebalance.html" title="Rebalancing is the process of redistributing information across nodes.">Rebalancing</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../Tasks/rebalance-performing.html" title="Rebalancing a cluster involves marking nodes to be added or removed from the cluster and performing the rebalance operation.">Performing a rebalance</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../Tasks/rebalance-bucket-types.html" title="The rebalance operation works across the cluster both on the Couchbase and memcached buckets.">Rebalance effect on bucket types</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b> All rights reserved.</span><a href="http://www.couchbase.com/developers">Developer Portal</a><a href="http://forums.couchbase.com">Forums</a><a href="http://www.couchbase.com/downloads">Download</a><a href="http://support.couchbase.com/">Customer Support Login</a></p></footer></div></main><script src="../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../';</script><script src="../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>