<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Conflict resolution in XDCR</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../assets/stylesheets/application.css"><link rel="stylesheet" href="../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation"><header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><a href="http://www.couchbase.com/learn" class="developer-porta-header__navigation__back">
							Return to Learn
						</a><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/developer">Developer Documentation</a></li><li class="developer-portal-header__navigation__item"><a href="http://developer.couchbase.com/mobile">Couchbase Mobile</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li><li class="developer-portal-header__navigation__item"><a href="http://docs.couchbase.com/archive-index">Documentation Archives</a></li></ul><div class="developer-portal-header__search"></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><div class="developer-portal-sidebar__versions"><ul id="developer-portal-versions-navigation"><li class="active"><a href="#"><span>Version 3.0</span></a></li><li class=""><a href="http://docs.couchbase.com/archive-index"><span>Older</span></a></li></ul></div><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../Couchbase-intro.html"><span>はじめに</span></a></li><li class="section"><a href="../Whats-new-3.0.html"><span>3.0の新機能</span></a></li><li class="section section--has-sub-sections"><a href="../install-intro.html"><span>インストールとアップグレード</span></a></li><li class="section section--has-sub-sections section--active"><a href="../admin-intro.html"><span>Couchbase Serverの管理</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../Misc/admin-basics.html"><span>Couchbase Server管理の基本</span></a></li><li class="section section--has-sub-sections"><a href="../Concepts/concept-intro.html"><span>アーキテクチャと概念</span></a></li><li class="section section--has-sub-sections"><a href="../security/security-intro.html"><span>セキュリティ</span></a></li><li class="section section--has-sub-sections"><a href="../Concepts/bp-deployment-considerations.html"><span>デプロイ構成の考慮事項</span></a></li><li class="section section--has-sub-sections section--active"><a href="../Tasks/cluster-management.html"><span>クラスタ管理</span></a><ul class="sub-sections"><li class="section"><a href="../Tasks/tasks-manage-serverWarmup.html"><span>サーバウォームアップの対処</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/tasks-manage-replication.html"><span>レプリケーションの設定</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/tasks-compaction.html"><span>データファイルのコンパクション</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/cluster-maintenance.html"><span>クラスタのメンテナンス</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/maintenance-server-node.html"><span>Server maintenance</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/tasks-backup-restore.html"><span>Backup and restore</span></a></li><li class="section section--has-sub-sections section--active"><a href="../Tasks/tasks-manage-xdcr.html"><span>Managing XDCR</span></a><ul class="sub-sections"><li class="section"><a href="../Tasks/xdcr-configure-replications.html"><span>Configuring XDCR replications</span></a></li><li class="section"><a href="../Tasks/xdcr-conflictResolution.html" class="current"><span>Conflict resolution in XDCR</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../Tasks/xdcr-secure-communication.html"><span>Securing data communication</span></a></li><li class="section"><a href="../Tasks/xdcr-tuning-optimistic-replication.html"><span>Tuning XDCR performance</span></a></li><li class="section"><a href="../Tasks/xdcr-configure-bidirection.html"><span>Configuring bi-directional replication</span></a></li><li class="section"><a href="../Tasks/xdcr-modify-settings.html"><span>Modifying XDCR settings</span></a></li><li class="section"><a href="../Tasks/tasks-dataRecovery.html"><span>Data recovery from remote clusters</span></a></li><li class="section"><a href="../XDCR/xdcr-memory-replication.html"><span>ストリームベースのXDCR</span></a></li></ul></li></ul></li><li class="section section--has-sub-sections"><a href="../Monitoring/monitor-intro.html"><span>モニタリング</span></a></li><li class="section section--has-sub-sections"><a href="../XDCR/xdcr-intro.html"><span>クロスデータセンターレプリケーション（XDCR）</span></a></li><li class="section section--has-sub-sections"><a href="../UI/ui-intro.html"><span>Webコンソール</span></a></li><li class="section"><a href="../Misc/faq.html"><span>FAQ</span></a></li><li class="section section--has-sub-sections"><a href="../Misc/Trbl-intro.html"><span>トラブルシューティング</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../Views/views-intro.html"><span>Viewとインデックス</span></a></li><li class="section section--has-sub-sections"><a href="../cli-intro.html"><span>CLIリファレンス</span></a></li><li class="section section--has-sub-sections"><a href="../rest-intro.html"><span>REST APIリファレンス</span></a></li><li class="section section--has-sub-sections"><a href="../rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
  <h1 class="title topictitle1">Conflict resolution in XDCR</h1>

  
  <div class="body"><p class="shortdesc">XDCR automatically performs conflict resolution for different document versions on source and
    destination clusters.</p>


      <p class="p">The algorithm is designed to consistently select the same document on
        either a source or destination cluster. For each stored document, XDCR perform checks of
        metadata to resolve conflicts. It checks the following:</p>
<ul class="ul">
          <li class="li"><p class="p">Numerical sequence, which is incremented on each mutation</p>
</li>

          <li class="li"><p class="p">CAS value</p>
</li>

          <li class="li"><p class="p">Document flags</p>
</li>

          <li class="li"><p class="p">Expiration (TTL) value</p>
</li>

        </ul>
<p class="p">If a document does not have the highest revision number, changes to this document will
          not be stored or replicated; instead the document with the highest score will take precedence on
          both clusters. Conflict resolution is automatic and does not require any manual correction or
          selection of documents.</p>
<p class="p">By default XDCR fetches metadata twice from every document before
            it replicates the document at a destination cluster. XDCR fetches metadata on the source cluster
            and looks at the number of revisions for a document. It compares this number with the number of
            revisions on the destination cluster and the document with more revisions is considered the
            ‘winner.’</p>
<p class="p">If XDCR determines a document from a source cluster will win conflict
              resolution, it puts the document into the replication queue. If the document will lose conflict
              resolution because it has a lower number of mutations, XDCR will not put it into the replication
              queue. Once the document reaches the destination, this cluster will request metadata once again
              to confirm the document on the destination has not changed since the initial check. If the
              document from the source cluster is still the ‘winner’ it will be persisted onto disk at the
              destination. The destination cluster will discard the document version with the lowest number of
              mutations.</p>
<p class="p">The key point is that the number of document mutations is the main factor that
                determines whether XDCR keeps a document version or not. This means that the document that has
                the most recent mutation may not be necessarily the one that wins conflict resolution. If both
                documents have the same number of mutations, XDCR selects a winner based on other document
                metadata. Precisely determining which document is the most recently changed is often difficult
                in a distributed system. The algorithm Couchbase Server uses does ensure that each cluster can
                independently reach a consistent decision on which document wins.</p>

  </div>

<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../Tasks/tasks-manage-xdcr.html" title="Cross datacenter replication (XDCR) provides an easy method of replicating data from one cluster to another for disaster recovery as well as better data locality (getting data closer to its users).">Managing XDCR</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../Tasks/xdcr-configure-replications.html" title="Configuration of XDCR replications is done on a per-bucket basis.">Configuring XDCR replications</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../Tasks/xdcr-secure-communication.html" title="To ensure security for the replicated information, configure a suitable VPN gateway between the two datacenters that encrypts the data between each route between datacenters.">Securing data communication</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b> All rights reserved.</span><a href="http://www.couchbase.com/developers">Developer Portal</a><a href="http://forums.couchbase.com">Forums</a><a href="http://www.couchbase.com/downloads">Download</a><a href="http://support.couchbase.com/">Customer Support Login</a></p></footer></div></main><script src="../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../';</script><script src="../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>