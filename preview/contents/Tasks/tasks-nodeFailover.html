<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>フェイルオーバの考慮事項</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../assets/stylesheets/application.css"><link rel="stylesheet" href="../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation"><header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><a href="http://www.couchbase.com/learn" class="developer-porta-header__navigation__back">
							Return to Learn
						</a><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/developer">Developer Documentation</a></li><li class="developer-portal-header__navigation__item"><a href="http://developer.couchbase.com/mobile">Couchbase Mobile</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li><li class="developer-portal-header__navigation__item"><a href="http://docs.couchbase.com/archive-index">Documentation Archives</a></li></ul><div class="developer-portal-header__search"></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><div class="developer-portal-sidebar__versions"><ul id="developer-portal-versions-navigation"><li class="active"><a href="#"><span>Version 3.0</span></a></li><li class=""><a href="http://docs.couchbase.com/archive-index"><span>Older</span></a></li></ul></div><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../Couchbase-intro.html"><span>はじめに</span></a></li><li class="section"><a href="../Whats-new-3.0.html"><span>3.0の新機能</span></a></li><li class="section section--has-sub-sections"><a href="../install-intro.html"><span>インストールとアップグレード</span></a></li><li class="section section--has-sub-sections section--active"><a href="../admin-intro.html"><span>Couchbase Serverの管理</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../Misc/admin-basics.html"><span>Couchbase Server管理の基本</span></a></li><li class="section section--has-sub-sections"><a href="../Concepts/concept-intro.html"><span>アーキテクチャと概念</span></a></li><li class="section section--has-sub-sections"><a href="../security/security-intro.html"><span>セキュリティ</span></a></li><li class="section section--has-sub-sections"><a href="../Concepts/bp-deployment-considerations.html"><span>デプロイ構成の考慮事項</span></a></li><li class="section section--has-sub-sections section--active"><a href="../Tasks/cluster-management.html"><span>クラスタ管理</span></a><ul class="sub-sections"><li class="section"><a href="../Tasks/tasks-manage-serverWarmup.html"><span>サーバウォームアップの対処</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/tasks-manage-replication.html"><span>レプリケーションの設定</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/tasks-compaction.html"><span>データファイルのコンパクション</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/cluster-maintenance.html"><span>クラスタのメンテナンス</span></a></li><li class="section section--has-sub-sections section--active"><a href="../Tasks/maintenance-server-node.html"><span>サーバのメンテナンス</span></a><ul class="sub-sections"><li class="section section--has-sub-sections section--active"><a href="../Concepts/concept-nodeFailover.html"><span>ノードのフェイルオーバ</span></a><ul class="sub-sections"><li class="section"><a href="../Tasks/tasks-nodeFailover.html" class="current"><span>フェイルオーバの考慮事項</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../Concepts/graceful-failover.html"><span>グレイスフルフェイルオーバ</span></a></li><li class="section"><a href="../Tasks/hard-failover.html"><span>ハードフェイルオーバ</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../Tasks/recovery-failover-nodes.html"><span>フェイルオーバしたノードのリカバリ</span></a></li><li class="section"><a href="../Tasks/rebalance-and-failover-nodes.html"><span>フェイルオーバ後のリバランス</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../Tasks/tasks-backup-restore.html"><span>Backup and restore</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/tasks-manage-xdcr.html"><span>XDCRの管理</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../Monitoring/monitor-intro.html"><span>モニタリング</span></a></li><li class="section section--has-sub-sections"><a href="../XDCR/xdcr-intro.html"><span>クロスデータセンターレプリケーション（XDCR）</span></a></li><li class="section section--has-sub-sections"><a href="../UI/ui-intro.html"><span>Webコンソール</span></a></li><li class="section"><a href="../Misc/faq.html"><span>FAQ</span></a></li><li class="section section--has-sub-sections"><a href="../Misc/Trbl-intro.html"><span>トラブルシューティング</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../Views/views-intro.html"><span>Viewとインデックス</span></a></li><li class="section section--has-sub-sections"><a href="../cli-intro.html"><span>CLIリファレンス</span></a></li><li class="section section--has-sub-sections"><a href="../rest-intro.html"><span>REST APIリファレンス</span></a></li><li class="section section--has-sub-sections"><a href="../rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
  <h1 class="title topictitle1">フェイルオーバの考慮事項</h1>

  
  <div class="body"><p class="shortdesc">ノードをフェイルオーバするとは、Couchbase Serverがそのノードをクラスタから削除し、他のノードにあるレプリケートしたデータをクライアントのリクエストで利用可能にすることです。</p>

    <p class="p"> Couchbase Serverはクラスタ内でのデータレプリケーションを提供しているため、保存されたデータへのアクセスに影響させることなく、クラスタは一つ以上のノード障害へ対応できます。
			ノード障害発生時には、Couchbase Webコンソールから、そのノードに<dfn class="term">failover</dfn>ステータスを設定し、問題を解決することができます。</p>

    <p class="p">または、クラスタから自動的に障害ノードを削除し、縮退モードでクラスタを稼働させるように設定することもできます。
			この自動オプションを選択した場合、クラスタ内に残る稼働中のノードに対する負荷は増大します。
      クラスタがノード障害前と同じ状態で機能するためには、正常に機能するノードをクラスタに戻し、リバランスを実行して、ノード障害から復旧する必要があります。</p>

    <p class="p">手動でフェイルオーバを実行しても、Couchbase Serverが自動的に実行するようにしても、障害の原因を解明する必要があります。
			そして、正常に機能するノードをセットアップし、そのノードを追加し、クラスタをリバランスします。
			ノード障害とフェイルオーバシナリオに対処する際は、ノードの交換および追加に関する以下のガイダンスを参考にしてください:</p>

    <ul class="ul">
      <li class="li"><p class="p">ハードウェアやシステム障害が起因してノードがダウンした場合、新規の交換用ノードをクラスタに追加してリバランスしてください。</p>
</li>

      <li class="li"><p class="p">クラスタのキャパシティ不足が原因でノードがダウンした場合、ノードの交換に加え、必要なキャパシティとするために必要な分だけノードを追加してください。</p>
</li>

      <li class="li"><p class="p">ノードの障害が一時的なもので、ノードが再び機能する場合、そのノードをクラスタに再追加することもできます。</p>
</li>

    </ul>

		<p class="p">フェイルオーバはノードの削除やノードのリバランスとは異なる操作であることに注意してください。
			一般的には、正常に機能しているノードをメンテナンスなどの理由でクラスタから削除しますが、一方、フェイルオーバは正常に動作していないノードに対して実行します。</p>

		<p class="p">クラスタから機能しているノードを削除するには、Couchbase Webコンソールを利用し、削除するノードを指定します。
			そしてクラスタをリバランスし、そのノードへのデータリクエストが他のノードで処理できるようにします。
			削除したいノードはまだ機能しているので、リバランスが完了するまでデータリクエストを処理することができます。
			この時点で、クラスタ内の他のノードによりデータリクエストが処理されることになります。 すなわち、データサービスを破壊するようなことも、データを消失してしまうこともなく、ノードを削除してクラスタをリバランスできるのです。
			機能しているノードを運用管理目的で削除したい場合、フェイルオーバではなく、Removeを利用し、リバランスを実行してください。</p>

    <p class="p">機能するノードをフェイルオーバする場合、フェイルオーバは即座にノードをクラスタから削除するため、データロスが発生する可能性があります。 まだ他のノードへレプリケートされていないデータは、ディスクに永続化されていない場合完全に消失してしまいます。</p>

    <p class="p">フェイルオーバの実行に関するより詳細な情報は次もご参照ください:</p>

    <ul class="ul">
      <li class="li">自動フェイルオーバ。 ノードが応答なし、または稼働していないと判断されると、ノードを自動的にフェイルオーバとしてマークします。 自動フェイルオーバ機能には設計上いくつかの制限があります。 </li>

      <li class="li">フェイルオーバの実行。 手動または自動のフェイルオーバのどちらを利用するかで、クラスタを完全に機能する状態へ戻すために、いくつかの手順を実行する必要があります。</li>

      <li class="li">フェイルオーバ後にノードを追加する。 フェイルオーバしたノードの問題を解決したら、ノードをクラスタへ再追加することができます。 </li>

    </ul>

    
    
    <div class="section"><h2 class="title sectiontitle">フェイルオーバ手段の選択</h2>
      <p class="p">フェイルオーバはクラスタの性能を縮小させてしまうため、フェイルオーバの状況をどのように処理すべきかをよく検討するべきです。
				自動フェイルオーバを利用すると、ユーザ操作なしにノードをフェイルオーバできますが、ノード障害を発生させた問題の調査や特定は難しくなります。
				クラスタを健全な状態に戻すためにはリバランスを実行する必要もあります。</p>

			<p class="p">手動フェイルオーバによりクラスタを管理する場合、クラスタを監視し、問題の発生を検知できるようにします。 問題が発生したら、手動でフェイルオーバを実行し、リバランスを行います。 この手順では、より多くの監視や手動の操作が必要で、加えて、フェイルオーバとリバランスを実行するまでの間、クラスタやデータアクセスが縮退してしまう可能性があります。</p>

			<p class="p">次のセクションでは二つの手段と、それぞれの問題についてより詳しく解説します。</p>

			<p class="p"><strong class="ph b">自動フェイルオーバの考慮事項</strong></p>
<p class="p">自動でコンポーネントを取り除くには、どんな分散システムでも問題が付き物です。 問題の原因を特定できない場合、または残りのシステムにかかる負荷を理解していない場合、自動フェイルオーバは問題を解決するどころか、より多くの問題を発生させる可能性があります。 次のような状況では、問題を誘発する可能性があります:</p>

      
      <ul class="ul">
        <li class="li"><strong class="ph b">フェイルオーバによる連鎖反応(Thundering Herd)の回避</strong></li>

      </ul>
<p class="p">5ノードのCouchbase Serverクラスタが、ネットワーク負荷キャパシティの80-90%で稼働しているとします。 すべては順調に稼働していますが、クラスタのキャパシティは限界です。 ノード障害が発生し、ソフトウェアが自動的にノードをフェイルオーバしたとします。 残りの4ノードでは負荷が増大し、正常に処理することはできないでしょう。</p>
<p class="p">結果として負荷が増加することで、他のノードもダウンし、自動的にフェイルオーバされてしまいます。 これらの障害は連鎖し、結果的にクラスタ全体の消失へとつながる可能性があります。 単一ノード障害発生時には、1/5のリクエストを処理できない方が、クラスタ全体の障害によってまったくリクエストを処理できないことよりも理想的であることは明確です。</p>
<p class="p">この場合の解決策は、単一ノード障害が発生してもクラスタの運用を続け、新しいサーバをクラスタに追加し、失われたキャパシティを補填して、ダウンしたノードを削除としてマークし、リバランスを実行することです。
				こうすれば、クラスタ全体が利用不可となる代わりに、部分的な停止で済みます。</p>

			<p class="p">もう一つの予防策は、予期せぬノード障害発生時にも十分な余剰のキャパシティを確保し、レプリカへの引き継ぎができるようにすることです。</p>

      
      <ul class="ul">
        <li class="li"><strong class="ph b">ネットワーク分断とフェイルオーバ</strong></li>

      </ul>
<p class="p">ネットワークデバイスの故障が原因でネットワークが分割されてしまう、ネットワーク分断やスプリットブレインの状況を考慮し、Couchbaseは以下の制約付きで自動フェイルオーバを実装しています:</p>

		<ul class="ul">
			<li class="li">自動フェイルオーバは最低でも1クラスタに3台のノードが必要。
				これは、ネットワーク分断が発生した際に、2ノードのクラスタがお互いのノードをフェイルオーバすることを防ぎ、データの整合性と一貫性を保護するためです。</li>

				<li class="li">自動フェイルオーバはノードが1台だけダウンしたときのみ実行される。
					これはネットワーク分断発生時に、2つ以上の部分的なクラスタがお互いをフェイルオーバすることを防ぎ、データの整合性と一貫性を保護するためです。</li>

				<li class="li">自動フェイルオーバは管理操作を必要とする前に一度だけ発動する。
					これは、フェイルオーバの連鎖や、以後の性能や安定性の劣化を防ぐためです。
					多くの場合、クラスタが機能できなくなるまで劣化し続けるよりも、データセットの小さな部分にアクセスできなくなる方が望ましいでしょう。</li>

				<li class="li">自動フェイルオーバはノードがダウンしてから自動フェイルオーバを実行するまでに30秒の遅延時間を設けています。
					これは一時的なネットワーク障害や、システムの遅延によって、誤ってノードがフェイルオーバされることを防ぎます。</li>

      </ul>
<p class="p">ネットワーク分断の際、特定の制限により許可された場合のみ、自動フェイルオーバが実行されます。 例えば、5ノードのクラスタで、1つのノードだけが分断された場合、それは自動でフェイルオーバされます。
				2つ以上のノードが分断された場合、自動フェイルオーバは実行されません。 自動フェイルオーバ後、リセットする管理操作が必要になります。 自動フェイルオーバをリセットする前に、他のノードがダウンすると、自動フェイルオーバは実行されません。 </p>
<ul class="ul">
        <li class="li"><strong class="ph b">不正に動作しているノードへの対処</strong></li>

      </ul>
<p class="p">あるノードがクラスタへの接続を失ったか、クラスタへの接続を失ったかのように動作する場合があります。 クラスタで自動フェイルオーバを有効にしている場合、そのノードは単一ノードのクラスタとなります。 結果としてこのクラスタは前述の分断状態と同様になります。</p>
<p class="p">この場合、ネットワークに問題があるノードをフェイルオーバするために十分なノードがクラスタに存在することを確認してください。
				十分なキャパシティが無いと判断した場合、ノードを追加し、問題のノードをフェイルオーバした後にキャパシティを補填します。</p>

			<p class="p"><strong class="ph b">手動フェイルオーバとモニタリング</strong></p>
<p class="p">モニタリング経由で手動フェイルオーバを行う場合、二つ方法があり、一つは人による監視、もう一つはCouchbase Serverクラスタの外部システムを利用する方法です。
			 外部モニタリングシステムはクラスタやノードの実行環境を監視でき、より多くの情報を元に判断できるようになります。
				手動フェイルオーバの手法を選択した場合、このほかにも意識すべき問題があります。
				自動フェイルオーバは潜在的な問題がありますが、手動またはモニタリングによるフェイルオーバにも潜在的な問題があります。</p>
<ul class="ul">
        <li class="li"><strong class="ph b">人の介入</strong></li>

				</ul>
<p class="p">アラートに対して次の行動に関する意思決定をする人員を確保することは一つの選択肢です。
				人間が広範囲のデータ、観測、経験を考慮し、最適な方法で状況を解決できるユニークな存在です。
				多くの組織では、人が影響に対する考慮をしないままにフェイルオーバを自動化することを許可していません。
				人の介入を行うことの問題点はコンピュータベースのモニタリングシステムを利用することに比べ、対応が遅くなるということです。</p>
<ul class="ul">
        <li class="li"><strong class="ph b">外部モニタリング</strong></li>

      </ul>
<p class="p">もう一つの選択肢はCouchbase REST APIを利用してクラスタをモニタリングするシステムを利用することです。
        このような外部システムは、Couchbase Serverのスコープ外のシステムコンポーネントに関しても考慮できるため、ノードのフェイルオーバにとって優位な位置に存在します。</p>

			<p class="p">例えば、モニタリングソフトウェアは、Couchbaseクラスタが依存するネットワークスイッチがダウンしていることを検知できます。 システムはCouchbase Serverノードをフェイルオーバしても状況は改善しないことが分かるため、ノードのフェイルオーバはしません。</p>

			<p class="p">モニタリングシステムはCouchbase Server周辺のコンポーネントが機能しているか、クラスタ内の様々なノードが健全であるかを判断することもできます。
				モニタリングシステムが、問題は単一のノードだけで起きており、クラスタ内の残りのノードで集約したトラフィックを処理できると判断すれば、システムからREST APIやコマンドラインツールを利用してそのノードをフェイルオーバすることもできます。</p>
</div>


    <div class="section"><h2 class="title sectiontitle">自動フェイルオーバの利用</h2><p class="p">Couchbase Serverの自動フェイルオーバには多くの制約があります。 これは自動フェイルオーバを利用する際に発生する可能性のある問題を回避するためです。 </p>
<ul class="ul">
        <li class="li"><p class="p"><strong class="ph b">デフォルトでは無効</strong> 自動フェイルオーバはデフォルトでは無効となっています。 これは明示的に有効とされるまで、Couchbase Serverが自動フェイルオーバを利用することを防止するためです。</p>
</li>

        <li class="li"><p class="p"><strong class="ph b">最小ノード数</strong> 自動フェイルオーバは最低でも3台のノードそ持つクラスタでしか利用できません。</p>
</li>

      </ul>
<p class="p">設定された遅延時間内に、同時に2台以上のノードがダウンした場合、自動フェイルオーバシステムはいずれのノードもフェイルオーバしません。</p>
<ul class="ul">
				<li class="li"><p class="p"><strong class="ph b">人の介入が必要</strong> 自動フェイルオーバは、人の介入が必要になる前に一つのノードだけをフェイルオーバします。
						これはクラスタ内の全ノードがダウンする連鎖反応を防止するためです。</p>
</li>

				<li class="li"><p class="p"><strong class="ph b">フェイルオーバの遅延時間</strong> ノードがフェイルオーバされるまでに、最低でも30秒の遅延時間が必要です。
						この時間を延ばすことはできますが、ソフトウェアはダウンしているかもしれないノードに対して複数回の死活監視を実行するようにハードコーディングされています。
						これは機能しているが遅いノードのフェイルオーバや、ネットワーク接続問題によりフェイルオーバが発動することを防ぐためです。 </p>
</li>

      </ul>
<p class="p">REST APIを利用して、ノード障害が発生し、ノードが自動でフェイルオーバされた際にCouchbase Serverがメールで通知を送信するように設定することができます。 </p>

      <p class="p">自動フェイルオーバが発生した後、Couchbaseクラスタは他のノードがレプリカデータを提供できることに依存しています。 クラスタを完全に機能する状態へと戻すためにリバランスを実行すべきです。 </p>

      <p class="p"><strong class="ph b">自動フェイルオーバカウンタのリセット</strong></p>
<p class="p">ノードが自動的にフェイルオーバされた後、Couchbase Serverはノードがフェイルオーバされたことを示す内部カウンタをインクリメントします。
				このカウンタは、フェイルオーバを引き起こした問題が特定され、解決されるまで、その他のノードが自動的にフェイルオーバされることを防止します。
				内部カウンタでノードがフェイルオーバされたことを示している場合、サーバはクラスタ内の他のノードを自動フェイルオーバしません。 このカウンタをリセットして、クラスタ内の自動フェイルオーバを再度有効にする必要があります。</p>

			<p class="p">重要</p>
<p class="p">自動フェイルオーバはノードの問題が解決し、クラスタが完全に機能する状態に戻ってからリセットしてください。</p>

			<p class="p">REST APIを利用してカウンタをリセットできます:</p>
<pre class="pre codeblock"><code><samp class="ph codeph">&gt; curl -i -u cluster-username:cluster-password \
    http://localhost:8091/settings/autoFailover/resetCount
</samp></code></pre>

    </div>

    <div class="section"><h2 class="title sectiontitle">ノードのフェイルオーバを実行する</h2><p class="p">ハードウェアやシステム障害によりクラスタからノードを削除する必要がある場合、そのノードのフェイルオーバを実行する必要があります。
				これは、Couchbase Serverが、クラスタ内の他の機能しているノードからレプリカデータを利用するということです。</p>

      
			<div class="note important"><span class="importanttitle">重要:</span> 運用管理、またはアップグレード操作として、機能しているノードをクラスタから削除するためにフェイルオーバを利用しないでください。
				これはフェイルオーバを実行すると、他のノードのレプリカデータがアクティブとなり、クラスタ全体のキャパシティが縮小してしまうからです。
        フェイルオーバされるノード上の、他のノードにレプリケートされていない、もしくはディスクに永続化されていないデータは消失します。 </div>

        
        <p class="p">ノードのフェイルオーバは二つの方法で実行できます:</p>
<ul class="ul">
        <li class="li"><strong class="ph b">Webコンソールの利用</strong></li>

      </ul>
<p class="p">Webコンソールの<samp class="ph codeph">Management -&gt; Server Nodes</samp> セクションに移動します。
        フェイルオーバしたいノードの<samp class="ph codeph">Fail Over</samp>ボタンをクリックします。
				クラスタがDownとして判定したノードのみフェイルオーバできます。</p>
<p class="p">Webコンソールに警告メッセージが表示されます。</p>
<p class="p"><samp class="ph codeph">Fail Over</samp>をクリックし、ノードをフェイルオーバします。
				<samp class="ph codeph">Cancel</samp>を選択することもできます。</p>
<ul class="ul">
        <li class="li"><strong class="ph b">コマンドラインツールの利用</strong></li>

				</ul>
<p class="p"><samp class="ph codeph">couchbase-cli</samp>の<samp class="ph codeph">failover</samp>コマンドを利用して、複数のノードをフェイルオーバできます。
				ノードをフェイルオーバするには、フェイルオーバするノードのIPアドレスと、標準のポートでない場合はポートを指定します。
					例:</p>
<pre class="pre codeblock"><code><samp class="ph codeph">```
&gt; ﻿couchbase-cli failover --cluster=localhost:8091\
    -u cluster-username -p cluster-password\
    --server-failover=192.168.0.72:8091
```
</samp></code></pre>

<p class="p">成功すると、ノードがフェイルオーバされたと表示されます。</p>

<p class="p">ノードをフェイルオーバした後は問題の原因を解決し、クラスタを完全に機能する状態に戻してください。 </p>

    </div>

    <div class="section"><h2 class="title sectiontitle">フェイルオーバ後の対応</h2><p class="p">自動でも、手動でもノードをフェイルオーバすると、クラスタのキャパシティは縮小します。 ノードをフェイルオーバしたら:</p>
<ul class="ul">
        <li class="li"><p class="p">クラスタ内の各データバケットに対する利用可能なノード数は一つ減少します。</p>
</li>

        <li class="li"><p class="p">フェイルオーバしたノードが担当していたデータのレプリカは、クラスタ内の他のノード上で有効化されます。</p>
</li>

        <li class="li"><p class="p">残りのノードがデータへのリクエストを処理しなくてはなりません。</p>
</li>

				</ul>
<p class="p">ノードをフェイルオーバした後、リバランスを実行すべきです。
				リバランス操作は:</p>
<ul class="ul">
        <li class="li"><p class="p">クラスタ内の残りのノード間でデータを再分配します。</p>
</li>

        <li class="li"><p class="p">残りのノードで全バケットのレプリカデータを再作成します。</p>
</li>

        <li class="li"><p class="p">クラスタを設定された運用可能な状態に復元します。</p>
</li>

      </ul>
<p class="p">クラスタを完全に機能する状態とするために、フェイルオーバ後に一つあるいは複数のノードをクラスタへと追加することもあるでしょう。 障害ノードを交換して、さらにノードを追加すれば、以前よりもキャパシティを拡張することができます。 </p>

    </div>

    <div class="section"><h2 class="title sectiontitle">フェイルオーバしたノードの再追加</h2><p class="p">ノード障害を引き起こした問題を回収できたなら、フェイルオーバしたノードをクラスタに再追加することができます。
				Couchbase Serverがノードをフェイルオーバとしてマークした後も、データはそのノード上のディスクに残っています。 フェイルオーバされたノードはもはや、元のクラスタと<em class="ph i">同期されていない</em>状態です; そのノードはデータリクエストを処理することもなく、レプリカデータを受信することもありません。</p>

			<p class="p">フェイルオーバしたノードをクラスタに再追加する際、クラスタはこれを新規ノードとして扱います。
				このため、ノードをクラスタに追加後、リバランスが必要です。
				これは、そのノードのディスクに保存されていたいかなるデータも、リバランスを実行すると削除されることを意味します。</p>

			<p class="p"><strong class="ph b">クラスタへの再追加前にデータをコピーまたは削除する</strong></p>
<p class="p">フェイルオーバしたノードをクラスタに再追加する前に、永続化されたデータファイルを移動するか削除することがベストプラクティスです。
				ファイルを保持したい場合は、他のディスクやEBSボリュームといった他のロケーションにファイルをコピーまたは移動します。
				クラスタにノードを再追加しリバランスすると、データファイルは削除され、再作成、再生成されます。</p>
</div>

  </div>

  <nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>親トピック:</strong> <a class="link" href="../Concepts/concept-nodeFailover.html" title="フェイルオーバはクラスタ内のノードを利用不可と宣言し、レプリカvBucketを有効にする処理です。">ノードのフェイルオーバ</a></div>
<div class="nextlink"><strong>次のトピック:</strong> <a class="link" href="../Concepts/graceful-failover.html" title="グレイスフルフェイルオーバは、実行中の操作が完了した後に、データを失うことなく、管理者が安全にノードをクラスタからフェイルオーバする方法を提供します。">グレイスフルフェイルオーバ</a></div>
</div>

<div class="linklist linklist">
<div><a class="link" href="tasks-rebalance.html" title="リバランスは情報をノード間に再分配する処理です。">リバランス</a></div>
<div><a class="link" href="../UI/ui-settings.html" title="The Settings section provides configuration and information for the cluster, update notifications, auto failover, alerts, auto compaction, sample buckets, and account management.">Settings</a></div>
<div><a class="link" href="../REST/rest-cluster-autofailover-intro.html" title="Auto-failover is managed with with the GET /settings/autoFailover HTTP method and URI.">Managing auto-failover</a></div>
<div><a class="link" href="../REST/rest-cluster-email-notifications.html" title="Alert settings specify whether email alerts are sent and the events that trigger emails. This is a global setting for all clusters. Authentication is required to read this value.">Setting email notifications</a></div></div>
</nav>
</div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b> All rights reserved.</span><a href="http://www.couchbase.com/developers">Developer Portal</a><a href="http://forums.couchbase.com">Forums</a><a href="http://www.couchbase.com/downloads">Download</a><a href="http://support.couchbase.com/">Customer Support Login</a></p></footer></div></main><script src="../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../';</script><script src="../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>