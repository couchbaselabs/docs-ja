<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Specifying backoff for replication</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../assets/stylesheets/application.css"><link rel="stylesheet" href="../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation"><header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><a href="http://www.couchbase.com/learn" class="developer-porta-header__navigation__back">
							Return to Learn
						</a><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/developer">Developer Documentation</a></li><li class="developer-portal-header__navigation__item"><a href="http://developer.couchbase.com/mobile">Couchbase Mobile</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li><li class="developer-portal-header__navigation__item"><a href="http://docs.couchbase.com/archive-index">Documentation Archives</a></li></ul><div class="developer-portal-header__search"></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><div class="developer-portal-sidebar__versions"><ul id="developer-portal-versions-navigation"><li class="active"><a href="#"><span>Version 3.0</span></a></li><li class=""><a href="http://docs.couchbase.com/archive-index"><span>Older</span></a></li></ul></div><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../Couchbase-intro.html"><span>はじめに</span></a></li><li class="section"><a href="../Whats-new-3.0.html"><span>3.0の新機能</span></a></li><li class="section section--has-sub-sections"><a href="../install-intro.html"><span>インストールとアップグレード</span></a></li><li class="section section--has-sub-sections section--active"><a href="../admin-intro.html"><span>Couchbase Serverの管理</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../Misc/admin-basics.html"><span>Couchbase Server管理の基本</span></a></li><li class="section section--has-sub-sections"><a href="../Concepts/concept-intro.html"><span>アーキテクチャと概念</span></a></li><li class="section section--has-sub-sections"><a href="../security/security-intro.html"><span>セキュリティ</span></a></li><li class="section section--has-sub-sections"><a href="../Concepts/bp-deployment-considerations.html"><span>デプロイ構成の考慮事項</span></a></li><li class="section section--has-sub-sections section--active"><a href="../Tasks/cluster-management.html"><span>クラスタ管理</span></a><ul class="sub-sections"><li class="section"><a href="../Tasks/tasks-manage-serverWarmup.html"><span>サーバウォームアップの対処</span></a></li><li class="section section--has-sub-sections section--active"><a href="../Tasks/tasks-manage-replication.html"><span>レプリケーションの設定</span></a><ul class="sub-sections"><li class="section"><a href="../Tasks/replication-backoff.html" class="current"><span>Specifying backoff for replication</span></a><ul class="sub-sections"></ul></li></ul></li><li class="section section--has-sub-sections"><a href="../Tasks/tasks-compaction.html"><span>データファイルのコンパクション</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/cluster-maintenance.html"><span>クラスタのメンテナンス</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/maintenance-server-node.html"><span>サーバのメンテナンス</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/tasks-backup-restore.html"><span>Backup and restore</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/tasks-manage-xdcr.html"><span>XDCRの管理</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../Monitoring/monitor-intro.html"><span>モニタリング</span></a></li><li class="section section--has-sub-sections"><a href="../XDCR/xdcr-intro.html"><span>クロスデータセンターレプリケーション（XDCR）</span></a></li><li class="section section--has-sub-sections"><a href="../UI/ui-intro.html"><span>Webコンソール</span></a></li><li class="section"><a href="../Misc/faq.html"><span>FAQ</span></a></li><li class="section section--has-sub-sections"><a href="../Misc/Trbl-intro.html"><span>トラブルシューティング</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../Views/views-intro.html"><span>Viewとインデックス</span></a></li><li class="section section--has-sub-sections"><a href="../cli-intro.html"><span>CLIリファレンス</span></a></li><li class="section section--has-sub-sections"><a href="../rest-intro.html"><span>REST APIリファレンス</span></a></li><li class="section section--has-sub-sections"><a href="../rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
  <h1 class="title topictitle1">Specifying backoff for replication</h1>

  
  <div class="body"><p class="shortdesc">Data replication enables high availability of data in a cluster so that data is still available at a replica in case any node in a cluster fails. </p>

      
      <p class="p">Your cluster is set up to perform some level of data replication between nodes within
        the cluster for any given node. Every node contains both active data and replica data.
        Active data is all the data that had been written to the node from a client, while
        replica data is a copy of data from another node in the cluster. </p>

      
      <p class="p">On any given node, both active and replica data must wait in a disk write queue before
        being persisted, or written to disk. If your node experiences a heavy load of writes, the replication
        queue can become overloaded with replica and active data waiting to be persisted.</p>

      
      <p class="p">By default, a node will send backoff messages when the disk write queue on the node
        contains one million items or 10%. When other nodes receive this message, they will
        reduce the rate at which they send replica data. You can configure this default to be a
        given number so long as this value is less than 10% of the total items currently in a
        replica partition. For instance, if a node contains 20 million items, when the disk write
        queue reaches 2 million items a backoff message will be sent to nodes sending replica
        data. You use the Couchbase command-line tool, <span class="keyword cmdname">cbepctl</span> to change this
        configuration:</p>

      
      <dl class="dl">
        
          <dt class="dt dlterm">Example 1</dt>

          <dd class="dd">A node sends replication backoff requests when it has two
            million items or 10% of all items, whichever is greater.
            <pre class="pre codeblock"><code>&gt; ./cbepctl 10.5.2.31:11210 -b bucket_name -p bucket_password set tap_param tap_throttle_queue_cap 2000000
</code></pre>
</dd>

        
      </dl>

     
  <dl class="dl">
    
      <dt class="dt dlterm">Example 2</dt>

      <dd class="dd">The default percentage, used to manage the replication stream,
        is changed. If the items in a disk write queue reach the greater of this percentage or a
        specified number of items, replication requests slow down:
        <pre class="pre codeblock"><code>setting param: tap_throttle_queue_cap 2000000
</code></pre>

      </dd>

    
  </dl>

      
  <dl class="dl">
    
      <dt class="dt dlterm">Example 3</dt>

      <dd class="dd">The threshold is set to 15% of all items at a replica node.
        When a disk write queue on a node reaches this point, it sends replication backoff
        requests to other nodes.
        <pre class="pre codeblock"><code>&gt; ./cbepctl  10.5.2.31:11210 set -b bucket_name tap_param tap_throttle_cap_pcnt 15
</code></pre>
</dd>

    
  </dl>
    
       
      <div class="note important"><span class="importanttitle">Important:</span> The <samp class="ph codeph">cbepctl</samp> tool provides per-node, per-bucket
        operations. That means that if you want to perform this operation, you must specify the
        IP address of a node in the cluster and a named bucket. If you do not provided a named
        bucket, the server applies the setting to any default bucket that exists at the
        specified node. If you want to perform this operation for an entire cluster, perform the
        command for every node/bucket combination that exists for that cluster.</div>

      <p class="p"> You can also monitor the progress of this backoff operation in Couchbase Web Console
        under <span class="ph menucascade"><span class="ph uicontrol">Tap Queue Statistics</span> &gt; <span class="ph uicontrol">Back-off rate.</span></span> </p>

    
  </div>

<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../Tasks/tasks-manage-replication.html" title="レプリカデータはCouchbaseクラスタ内で分散され、単一障害点を回避します。 データのレプリケーションはバケットごとに、ノード単位で構成されます。">レプリケーションの設定</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b> All rights reserved.</span><a href="http://www.couchbase.com/developers">Developer Portal</a><a href="http://forums.couchbase.com">Forums</a><a href="http://www.couchbase.com/downloads">Download</a><a href="http://support.couchbase.com/">Customer Support Login</a></p></footer></div></main><script src="../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../';</script><script src="../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>