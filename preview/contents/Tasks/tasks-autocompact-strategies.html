<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Auto-compaction configuration and strategies</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../assets/stylesheets/application.css"><link rel="stylesheet" href="../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation"><header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><a href="http://www.couchbase.com/learn" class="developer-porta-header__navigation__back">
							Return to Learn
						</a><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/developer">Developer Documentation</a></li><li class="developer-portal-header__navigation__item"><a href="http://developer.couchbase.com/mobile">Couchbase Mobile</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li><li class="developer-portal-header__navigation__item"><a href="http://docs.couchbase.com/archive-index">Documentation Archives</a></li></ul><div class="developer-portal-header__search"><script>
					  (function() {
					    var cx = '018016427239405524608:fkg1v30apnm';
					    var gcse = document.createElement('script');
					    gcse.type = 'text/javascript';
					    gcse.async = true;
					    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
					        '//www.google.com/cse/cse.js?cx=' + cx;
					    var s = document.getElementsByTagName('script')[0];
					    s.parentNode.insertBefore(gcse, s);
					  })();
					</script><gcse:search></gcse:search></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><div class="developer-portal-sidebar__versions"><ul id="developer-portal-versions-navigation"><li class="active"><a href="#"><span>Version 3.0</span></a></li><li class=""><a href="http://docs.couchbase.com/archive-index"><span>Older</span></a></li></ul></div><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../Couchbase-intro.html"><span>はじめに</span></a></li><li class="section"><a href="../Whats-new-3.0.html"><span>3.0の新機能</span></a></li><li class="section section--has-sub-sections"><a href="../install-intro.html"><span>インストールとアップグレード</span></a></li><li class="section section--has-sub-sections section--active"><a href="../admin-intro.html"><span>Couchbase Serverの管理</span></a><ul class="sub-sections"><li class="section section--has-sub-sections"><a href="../Misc/admin-basics.html"><span>管理の基礎</span></a></li><li class="section section--has-sub-sections"><a href="../Concepts/concept-intro.html"><span>アーキテクチャと概念</span></a></li><li class="section section--has-sub-sections"><a href="../security/security-intro.html"><span>セキュリティ</span></a></li><li class="section section--has-sub-sections"><a href="../Concepts/bp-deployment-considerations.html"><span>デプロイ構成の考慮事項</span></a></li><li class="section section--has-sub-sections section--active"><a href="../Tasks/cluster-management.html"><span>クラスタ管理</span></a><ul class="sub-sections"><li class="section"><a href="../Tasks/tasks-manage-serverWarmup.html"><span>サーバウォームアップの対処</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/tasks-manage-replication.html"><span>レプリケーションの設定</span></a></li><li class="section section--has-sub-sections section--active"><a href="../Tasks/tasks-compaction.html"><span>Compacting data files</span></a><ul class="sub-sections"><li class="section"><a href="../Tasks/tasks-compaction-process.html"><span>Compaction process</span></a></li><li class="section"><a href="../Tasks/tasks-autocompact-strategies.html" class="current"><span>Auto-compaction configuration and strategies</span></a><ul class="sub-sections"></ul></li></ul></li><li class="section section--has-sub-sections"><a href="../Tasks/cluster-maintenance.html"><span>Cluster maintenance</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/maintenance-server-node.html"><span>Server maintenance</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/tasks-backup-restore.html"><span>Backup and restore</span></a></li><li class="section section--has-sub-sections"><a href="../Tasks/tasks-manage-xdcr.html"><span>Managing XDCR</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../Monitoring/monitor-intro.html"><span>モニタリング</span></a></li><li class="section section--has-sub-sections"><a href="../XDCR/xdcr-intro.html"><span>クロスデータセンターレプリケーション（XDCR）</span></a></li><li class="section section--has-sub-sections"><a href="../UI/ui-intro.html"><span>Webコンソール</span></a></li><li class="section"><a href="../Misc/faq.html"><span>FAQ</span></a></li><li class="section section--has-sub-sections"><a href="../Misc/Trbl-intro.html"><span>トラブルシューティング</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../Views/views-intro.html"><span>Views and indexes</span></a></li><li class="section section--has-sub-sections"><a href="../cli-intro.html"><span>CLIリファレンス</span></a></li><li class="section section--has-sub-sections"><a href="../rest-intro.html"><span>REST APIリファレンス</span></a></li><li class="section section--has-sub-sections"><a href="../rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
  <h1 class="title topictitle1">Auto-compaction configuration and strategies</h1>

  
  <div class="body"><p class="shortdesc">Couchbase Server incorporates an automated
    compaction mechanism that can compact both data files and the view index files based on
    triggers that measure the current fragmentation level within the database and view index data
    files.</p>

<div class="note note"><span class="notetitle">Note:</span> Spatial indexes are not automatically compacted. They must be compacted manually. </div>

    
    <div class="section"><h2 class="title sectiontitle">Configuration</h2>
    <p class="p">Auto-compaction can be configured using:</p>

    <ul class="ul">
          <li class="li"><dfn class="term">Default auto-compaction</dfn>, which affects all the Couchbase buckets within
       Couchbase Server. If you set the default auto-compaction settings for Couchbase
       Server, auto-compaction is automatically enabled for all Couchbase buckets. </li>

          <li class="li"><dfn class="term">Bucket auto-compaction,</dfn> which can be set on individual Couchbase buckets.
        The bucket-level compaction always overrides any default auto-compaction settings, even if
        they have not been configured. You can choose to explicitly override any Couchbase
        bucket-specific settings when editing or creating a new Couchbase bucket.</li>

        </ul>

    
    <p class="p">The available settings both for default auto-compaction and Couchbase bucket specific
      settings are identical:</p>

    <dl class="dl">
      
        <dt class="dt dlterm">Database Fragmentation</dt>

        <dd class="dd">The primary setting is the percentage level within the database at which compaction
          occurs. The figure is expressed as a percentage of fragmentation for each item, and you can set
          the fragmentation level at which the compaction process is triggered.
          <p class="p">For example, if
            you set the fragmentation percentage at 10%, the moment the fragmentation level has been
            identified, the compaction process will be started, unless you have time limited
            auto-compaction. See <dfn class="term">Time Period</dfn>.</p>
</dd>

      
    </dl>

    <dl class="dl">
      
        <dt class="dt dlterm">View Fragmentation</dt>

        <dd class="dd">It specifies the percentage of fragmentation within all the view
          index files at which compaction is triggered, expressed as a percentage.</dd>

      
    </dl>

    <dl class="dl">
      
        <dt class="dt dlterm">Time Period</dt>

        <dd class="dd">To prevent that auto compaction takes place when your database is in heavy use, you can
          configure a time during which compaction is allowed. This is expressed as the hour and minute
          combination between which compaction occurs. For example, you could configure compaction to take
          place between 01:00 and 06:00.<p class="p">If compaction is identified as required outside of these
            hours, compaction will be delayed until the specified time period is reached. The time period is
            applied every day while Couchbase Server is active. The time period cannot be configured on
            a day-by-day basis.</p>
</dd>

      
    </dl>

    <dl class="dl">
      
        <dt class="dt dlterm">Compaction Abortion</dt>

        <dd class="dd">The compaction process can be configured so that if the allowed compaction time period
            ends while the compaction process is still going on, the entire compaction process will
            be terminated. This option affects the compaction process and if this option is enabled
            and compaction is running, the process will be stopped. The files generated during the
            compaction process will be kept, and compaction will be restarted when the next time
            period is reached. This can be a useful setting if you want to ensure the performance of
            Couchbase Server during a specified time period, as this will ensure that
            compaction is never running outside of the specified time period. <p class="p">If this option is
              disabled and the compaction is running when the time period ends, compaction will
              continue until the process has been completed.</p>
<p class="p">Using this option can be useful
              if you want to ensure that the compaction process completes.</p>
</dd>

      
    </dl>

   <dl class="dl">
     
       <dt class="dt dlterm">Parallel Compaction</dt>

       <dd class="dd">By default, compaction operates sequentially executing first on the database and then
         the views (if both are configured for auto-compaction). If you enable parallel compaction, both
         the databases and the views can be compacted at the same time. This requires more CPU and
         database activity for both to be processed simultaneously, but if you have CPU cores and disk
         I/O (for example, if the database and view index information is stored on different physical
         disk devices), the two can complete in a shorter time.</dd>

     
   </dl>

    <dl class="dl">
      
        <dt class="dt dlterm">Metadata Purge Interval</dt>

        <dd class="dd">You can remove <dfn class="term">tombstones</dfn> for expired and deleted items as part of the auto-compaction
          process. Tombstones are records containing the key and metadata for deleted and expired
          items and are used for consistency between clusters and for views.
            <p class="p">Configuration of auto-compaction is performed using Couchbase Web Console. Information on
            per-bucket settings is available in the <span class="keyword wintitle">Couchbase Bucket create/edit</span> screen. You can also
            view and change these settings using the REST API.</p>
</dd>

      
    </dl>
   </div>
                         
      
    <div class="section"><h2 class="title sectiontitle">Auto-compaction strategies</h2>
      
      <p class="p">Choose carefully the exact fragmentation and scheduling
      settings for auto-compaction to ensure that the database and compaction performance meet your requirements.</p>

      <p class="p">Take <strong class="ph b">into</strong> consideration the following:</p>
<ul class="ul">
        <li class="li">Monitor the compaction process to determine how long it takes to compact your
          database. This will help you identify and schedule a suitable time period for auto-compaction
          to occur.</li>

        <li class="li">Compaction affects the disk space usage of your database, but it must not affect
          performance. Frequent compactions run on a small database file are unlikely to cause problems,
          but frequent compactions on a large database file may impact the performance and disk
          usage.</li>

        <li class="li">Compaction can be terminated at any time. This means that if you schedule compaction for
          a specific time period, but then require the additional resources, terminate the compaction 
          and restart during another off-peak period.</li>

        <li class="li">Since compaction can be stopped and restarted, it is possible to indirectly trigger an
          incremental compaction. For example, if you configure a one hour compaction period and enable
          Compaction abortion, if compaction takes 4 hours to complete it will incrementally
          take place over four days.</li>

        <li class="li">When you have a large number of Couchbase buckets on which you want to use
          auto-compaction, you might want to schedule your auto-compaction time period for each bucket in
          a staggered fashion so that compaction on each bucket can take place within it’s own unique
          time period.</li>

      </ul>
</div>

  </div>

  
 
<nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../Tasks/tasks-compaction.html" title="Database and view compaction helps to reclaim disk space and reduce fragmentation.">Compacting data files</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../Tasks/tasks-compaction-process.html" title="Couchbase Server compacts views and data files.">Compaction process</a></div>
</div>
</nav></div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b> All rights reserved.</span><a href="http://www.couchbase.com/developers">Developer Portal</a><a href="http://forums.couchbase.com">Forums</a><a href="http://www.couchbase.com/downloads">Download</a><a href="http://support.couchbase.com/">Customer Support Login</a></p></footer></div></main><script src="../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../';</script><script src="../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>