<!DOCTYPE html><html xmlns:related-links="http://dita-ot.sourceforge.net/ns/200709/related-links" class="no-js developer-portal" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Offline upgrade</title><meta name="apple-mobile-web-app-title" content="Couchbase"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-precomposed.png"><link rel="stylesheet" href="../assets/stylesheets/application.css"><link rel="stylesheet" href="../assets/stylesheets/docs.css"></head><body data-modules="developer-portal-sidebar-navigation developer-portal-versions-navigation"><header class="developer-portal-header" role="banner"><div class="layout-wrapper"><div class="developer-portal-header__hgroup"><h1 class="developer-portal-header__logo"><a href="http://couchbase.com" rel="home">Couchbase</a></h1><p class="developer-portal-header__page-title">Couchbase Server</p></div><nav class="developer-portal-header__navigation" id="primary-navigation" role="navigation"><div class="developer-portal-header__navigation__wrapper" id="primary-navigation__wrapper"><a href="http://www.couchbase.com/learn" class="developer-porta-header__navigation__back">
							Return to Learn
						</a><ul class="developer-portal-header__navigation__items"><li class="developer-portal-header__navigation__item"><a href="/developer">Developer Documentation</a></li><li class="developer-portal-header__navigation__item"><a href="http://developer.couchbase.com/mobile">Couchbase Mobile</a></li><li class="developer-portal-header__navigation__item"><a href="http://www.couchbase.com/open-source">Open Source Projects</a></li><li class="developer-portal-header__navigation__item"><a href="http://forums.couchbase.com">Forums</a></li><li class="developer-portal-header__navigation__item"><a href="http://docs.couchbase.com/archive-index">Documentation Archives</a></li></ul><div class="developer-portal-header__search"></div></div></nav></div></header><main class="developer-portal-global-content" role="main"><aside class="developer-portal-sidebar"><div class="developer-portal-sidebar__versions"><ul id="developer-portal-versions-navigation"><li class="active"><a href="#"><span>Version 3.0</span></a></li><li class=""><a href="http://docs.couchbase.com/archive-index"><span>Older</span></a></li></ul></div><nav class="developer-portal-sidebar__navigation"><div class="developer-portal-sidebar__navigation__wrapper" id="developer-portal-sidebar-navigation"><ul><li class="section section--has-sub-sections"><a href="../Couchbase-intro.html"><span>はじめに</span></a></li><li class="section"><a href="../Whats-new-3.0.html"><span>3.0の新機能</span></a></li><li class="section section--has-sub-sections section--active"><a href="../install-intro.html"><span>インストールとアップグレード</span></a><ul class="sub-sections"><li class="section"><a href="../Install/setup-overview.html"><span>Couchbaseセットアップの概要</span></a></li><li class="section section--has-sub-sections"><a href="../Install/pre-install.html"><span>インストール要件</span></a></li><li class="section section--has-sub-sections"><a href="../Install/RHEL-install-intro.html"><span>Red Hat/CentOS installation</span></a></li><li class="section section--has-sub-sections"><a href="../Install/Ubuntu-install.html"><span>UbuntuまたはDebianへのインストール方法</span></a></li><li class="section section--has-sub-sections"><a href="../Install/Windows-install.html"><span>Microsoft Windows へのインストール</span></a></li><li class="section section--has-sub-sections"><a href="../Install/Mac-install.html"><span>Mac OS X へのインストール</span></a></li><li class="section section--has-sub-sections"><a href="../Install/post-install.html"><span>インストール後の設定</span></a></li><li class="section section--has-sub-sections section--active"><a href="../Install/upgrading.html"><span>Upgrading </span></a><ul class="sub-sections"><li class="section"><a href="../Install/supported_upgrade-paths.html"><span>Supported upgrade paths</span></a></li><li class="section"><a href="../Install/upgrade-online.html"><span>Online upgrade with swap rebalance</span></a></li><li class="section"><a href="../Install/upgrade-offline.html" class="current"><span>Offline upgrade</span></a><ul class="sub-sections"></ul></li><li class="section"><a href="../Install/upgrade-individual-nodes.html"><span>Upgrading one node</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../Install/migrating.html"><span>Migrating</span></a></li></ul></li><li class="section section--has-sub-sections"><a href="../admin-intro.html"><span>Couchbase Serverの管理</span></a></li><li class="section section--has-sub-sections"><a href="../Views/views-intro.html"><span>Viewとインデックス</span></a></li><li class="section section--has-sub-sections"><a href="../cli-intro.html"><span>CLIリファレンス</span></a></li><li class="section section--has-sub-sections"><a href="../rest-intro.html"><span>REST APIリファレンス</span></a></li><li class="section section--has-sub-sections"><a href="../rel-notes/rel-notes3.0.html"><span>Release notes</span></a></li></ul></div></nav></aside><div class="developer-portal-content"><div class="developer-portal-content__wrapper textblock__content">
  <h1 class="title topictitle1">Offline upgrade</h1>

  
  
  <div class="body"><p class="shortdesc">During an offline upgrade, the cluster must be shut down and all applications built on it will not be
    available during that time.</p>

    
    
    
      
      <div class="note note"><span class="notetitle">Note:</span> If you are upgrading from Couchbase
        Server 1.8 to Couchbase Server 2.0 or later, there are more steps for the upgrade because
        you must first upgrade to Couchbase 1.8.1 for data compatibility.</div>

      
      <div class="note tip"><span class="tiptitle">Tip:</span> Check that the disk write queue is completely drained to make sure that 
        all data has been persisted to disk and will be available after the upgrade. It is 
        recommended that you turn off your application and allow the queue to drain before upgrading.
        Back up all data before upgrading. </div>

      
      <p class="p">To perform an offline upgrade:</p>

      <ol class="ol">
            <li class="li">Under <span class="ph menucascade"><span class="ph uicontrol">Settings</span> &gt; <span class="ph uicontrol">Auto-Failover</span></span>, disable auto-failover for all nodes in the cluster. If you leave
            this option enabled, the first node that you shut down will be auto-failed over. </li>

            <li class="li">Shut down your application so that no more requests are forwarded to Couchbase Cluster.
              <p class="p">You can monitor the activity of your cluster by using the Couchbase Web Console. The
                cluster needs to finish writing all information to disk. This will make sure that when you
                restart your cluster, all of your data can be brought back into the caching layer from
                disk. You can do this by monitoring the Disk Write Queue for every bucket in your
                cluster. When the queue reaches zero, no more data remains to be
                written to disk.</p>
</li>

        <li class="li">Open the Couchbase Web Console at a node in your cluster.</li>

            <li class="li">Click <span class="ph uicontrol">Data Buckets |<var class="keyword varname">your_bucket</var></span>. 
              In the <span class="keyword wintitle">Summary</span> section, check that
              <span class="keyword wintitle">Disk write queue</span> reads 0. If you have more than one data bucket in 
              your cluster, repeat this step to verify that each bucket has a disk write queue of 0.
                <div class="fig fignone"><img class="image" src="../images/upgrade_disk_write_zero.png" width="800"></div>
</li>

            <li class="li">Create a backup of your cluster data using <span class="keyword cmdname">cbbackup</span>. </li>

            <li class="li">Shut down Couchbase Server on each machine in your cluster.</li>

            <li class="li">After you shut down the nodes, perform a standard node upgrade to the new version of
              Couchbase Server as explained in <a class="xref" href="upgrade-individual-nodes.html" title="To upgrade a single Couchbase Server node, first back it up and then install the software.">Upgrading one node</a>.
              <p class="p">Couchbase Server starts automatically on each node after you perform the node
                upgrade.</p>
</li>

            <li class="li">As the cluster warms up, you can monitor the status of the warmup process to
              determine when you can switch on your application.</li>

          </ol>

      <p class="p">After the cluster finishes warmup, you can restart your application on the upgraded
            cluster.</p>

    
    
    <div class="section"><h2 class="title sectiontitle">Offline upgrade to Enterprise Edition</h2><p class="p">Shut down the
      entire cluster and uninstall Couchbase Server Community Edition from each machine. Then
      install Couchbase Server Enterprise Edition on these machines. The data files will be retained, and the
      cluster can be restarted.</p>
</div>

    
  </div>

  <nav class="related-links"><h2>Related information</h2>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a class="link" href="../Install/upgrading.html" title="The Couchbase Server can be upgraded online (using swap rebalance or the standard online upgrade), offline, or using XDCR.">Upgrading</a></div>
<div class="previouslink"><strong>Previous topic:</strong> <a class="link" href="../Install/upgrade-online.html" title="Online upgrade with swap rebalance is the preferred upgrade method because cluster capacity is always maintained throughout the upgrade.">Online upgrade with swap rebalance</a></div>
<div class="nextlink"><strong>Next topic:</strong> <a class="link" href="../Install/upgrade-individual-nodes.html" title="To upgrade a single Couchbase Server node, first back it up and then install the software.">Upgrading one node</a></div>
</div>

<div class="linklist linklist">
<div><a class="link" href="../Tasks/tasks-backup-restore.html" title="Back up your entire cluster periodically to minimize data inconsistency when a restore is required.">Backup and restore</a></div>
<div><a class="link" href="../Concepts/concept-serverWarmup.html" title="Couchbase Serverを再起動、またはサーバインスタンスにデータをリストアすると、サーバはデータリクエストを受け付ける前にウォームアップ処理を実行します。">サーバウォームアップ</a></div>
<div><a class="link" href="../Monitoring/monitor-warmup.html">Monitoring startup (warmup)</a></div>
<div><a class="link" href="../Monitoring/monitor-diskqueue.html" title="Disk writing is implemented as a 2-queue system: commit to DRAM and then queued to be written to disk">Disk write queue</a></div>
<div><a class="link" href="../CLI/cbbackup_tool.html" title="cbbackupツールは、稼働中の全クラスタ・全バケット・単一ノード・正常稼働中ノード上の単一バケット のコピーを作成します。">cbbackupツール</a></div>
<div><a class="link" href="../UI/ui-settings-autofailover.html">Auto-Failover tab</a></div></div>
</nav>
</div><footer class="developer-portal-footer" role="contentinfo"><p class="legal"><span class="license">© 2011–2015 <b class="company-name">Couchbase</b> All rights reserved.</span><a href="http://www.couchbase.com/developers">Developer Portal</a><a href="http://forums.couchbase.com">Forums</a><a href="http://www.couchbase.com/downloads">Download</a><a href="http://support.couchbase.com/">Customer Support Login</a></p></footer></div></main><script src="../assets/javascripts/vendor/prism.js"></script><script type="text/javascript">var BASEPATH='../';</script><script src="../assets/javascripts/init.js"></script><script type="text/javascript" src="https://issues.couchbase.com/s/en_US-pvmaib-418945332/845/131/1.2.9/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?collectorId=86389172"></script></body></html>